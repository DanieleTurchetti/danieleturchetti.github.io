<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Multilevel Modelling Practical 1 (Week 2) | MLM_worksheets.knit</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Multilevel Modelling Practical 1 (Week 2) | MLM_worksheets.knit" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Multilevel Modelling Practical 1 (Week 2) | MLM_worksheets.knit" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="multilevel-modelling-practical-2-week-3.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Home</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome to multilevel modelling</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#including-plots"><i class="fa fa-check"></i><b>1.1</b> Including Plots</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="multilevel-modelling-practical-1-week-2.html"><a href="multilevel-modelling-practical-1-week-2.html"><i class="fa fa-check"></i><b>2</b> Multilevel Modelling Practical 1 (Week 2)</a>
<ul>
<li class="chapter" data-level="2.1" data-path="multilevel-modelling-practical-1-week-2.html"><a href="multilevel-modelling-practical-1-week-2.html#instructions-start-here"><i class="fa fa-check"></i><b>2.1</b> Instructions – start here!</a></li>
<li class="chapter" data-level="2.2" data-path="multilevel-modelling-practical-1-week-2.html"><a href="multilevel-modelling-practical-1-week-2.html#exercises-1"><i class="fa fa-check"></i><b>2.2</b> Exercises 1</a></li>
<li class="chapter" data-level="2.3" data-path="multilevel-modelling-practical-1-week-2.html"><a href="multilevel-modelling-practical-1-week-2.html#exercises-2"><i class="fa fa-check"></i><b>2.3</b> Exercises 2</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="multilevel-modelling-practical-2-week-3.html"><a href="multilevel-modelling-practical-2-week-3.html"><i class="fa fa-check"></i><b>3</b> Multilevel Modelling Practical 2 (Week 3)</a>
<ul>
<li class="chapter" data-level="3.1" data-path="multilevel-modelling-practical-2-week-3.html"><a href="multilevel-modelling-practical-2-week-3.html#instructions-start-here-1"><i class="fa fa-check"></i><b>3.1</b> Instructions – start here!</a></li>
<li class="chapter" data-level="3.2" data-path="multilevel-modelling-practical-2-week-3.html"><a href="multilevel-modelling-practical-2-week-3.html#exercises-1-1"><i class="fa fa-check"></i><b>3.2</b> Exercises 1</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="multilevel-modelling-practical-2-week-3.html"><a href="multilevel-modelling-practical-2-week-3.html#acquire-and-prepare-data"><i class="fa fa-check"></i><b>3.2.1</b> Acquire and prepare data</a></li>
<li class="chapter" data-level="3.2.2" data-path="multilevel-modelling-practical-2-week-3.html"><a href="multilevel-modelling-practical-2-week-3.html#exploratory-analysis"><i class="fa fa-check"></i><b>3.2.2</b> Exploratory analysis</a></li>
<li class="chapter" data-level="3.2.3" data-path="multilevel-modelling-practical-2-week-3.html"><a href="multilevel-modelling-practical-2-week-3.html#naive-simple-linear-regression-models"><i class="fa fa-check"></i><b>3.2.3</b> Naive simple linear regression models</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="multilevel-modelling-practical-2-week-3.html"><a href="multilevel-modelling-practical-2-week-3.html#exercise-2"><i class="fa fa-check"></i><b>3.3</b> Exercise 2</a></li>
<li class="chapter" data-level="3.4" data-path="multilevel-modelling-practical-2-week-3.html"><a href="multilevel-modelling-practical-2-week-3.html#exercise-3-if-time"><i class="fa fa-check"></i><b>3.4</b> Exercise 3 (if time)</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="multilevel-modelling-practical-3-week-4.html"><a href="multilevel-modelling-practical-3-week-4.html"><i class="fa fa-check"></i><b>4</b> Multilevel Modelling Practical 3 (Week 4)</a>
<ul>
<li class="chapter" data-level="4.1" data-path="multilevel-modelling-practical-3-week-4.html"><a href="multilevel-modelling-practical-3-week-4.html#instructions-start-here-2"><i class="fa fa-check"></i><b>4.1</b> Instructions – start here!</a></li>
<li class="chapter" data-level="4.2" data-path="multilevel-modelling-practical-3-week-4.html"><a href="multilevel-modelling-practical-3-week-4.html#exercise-1"><i class="fa fa-check"></i><b>4.2</b> Exercise 1</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="multilevel-modelling-practical-3-week-4.html"><a href="multilevel-modelling-practical-3-week-4.html#preparation-of-the-data-set"><i class="fa fa-check"></i><b>4.2.1</b> Preparation of the data set</a></li>
<li class="chapter" data-level="4.2.2" data-path="multilevel-modelling-practical-3-week-4.html"><a href="multilevel-modelling-practical-3-week-4.html#fitting-the-random-intercept-and-slope-model"><i class="fa fa-check"></i><b>4.2.2</b> Fitting the random intercept and slope model</a></li>
<li class="chapter" data-level="4.2.3" data-path="multilevel-modelling-practical-3-week-4.html"><a href="multilevel-modelling-practical-3-week-4.html#fitted-lines-by-class"><i class="fa fa-check"></i><b>4.2.3</b> Fitted lines by class</a></li>
<li class="chapter" data-level="4.2.4" data-path="multilevel-modelling-practical-3-week-4.html"><a href="multilevel-modelling-practical-3-week-4.html#the-intercept-only-empty-model-and-icc"><i class="fa fa-check"></i><b>4.2.4</b> The intercept-only / empty model and ICC</a></li>
<li class="chapter" data-level="4.2.5" data-path="multilevel-modelling-practical-3-week-4.html"><a href="multilevel-modelling-practical-3-week-4.html#the-random-intercept-model-with-covariate"><i class="fa fa-check"></i><b>4.2.5</b> The random intercept model (with covariate)</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="multilevel-modelling-practical-3-week-4.html"><a href="multilevel-modelling-practical-3-week-4.html#exercise-2-1"><i class="fa fa-check"></i><b>4.3</b> Exercise 2</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="multilevel-modelling-practical-3-week-4.html"><a href="multilevel-modelling-practical-3-week-4.html#preparation"><i class="fa fa-check"></i><b>4.3.1</b> Preparation</a></li>
<li class="chapter" data-level="4.3.2" data-path="multilevel-modelling-practical-3-week-4.html"><a href="multilevel-modelling-practical-3-week-4.html#the-random-intercept-model"><i class="fa fa-check"></i><b>4.3.2</b> The random intercept model</a></li>
<li class="chapter" data-level="4.3.3" data-path="multilevel-modelling-practical-3-week-4.html"><a href="multilevel-modelling-practical-3-week-4.html#diagnostics"><i class="fa fa-check"></i><b>4.3.3</b> Diagnostics</a></li>
<li class="chapter" data-level="4.3.4" data-path="multilevel-modelling-practical-3-week-4.html"><a href="multilevel-modelling-practical-3-week-4.html#include-a-second-fixed-effect-variable-gender"><i class="fa fa-check"></i><b>4.3.4</b> Include a second fixed effect variable: gender</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="multilevel-modelling-practical-4-week-5.html"><a href="multilevel-modelling-practical-4-week-5.html"><i class="fa fa-check"></i><b>5</b> Multilevel Modelling Practical 4 (Week 5)</a>
<ul>
<li class="chapter" data-level="5.1" data-path="multilevel-modelling-practical-4-week-5.html"><a href="multilevel-modelling-practical-4-week-5.html#instructions-start-here-3"><i class="fa fa-check"></i><b>5.1</b> Instructions – start here!</a></li>
<li class="chapter" data-level="5.2" data-path="multilevel-modelling-practical-4-week-5.html"><a href="multilevel-modelling-practical-4-week-5.html#exercise-1-analysis-of-the-active-time-study-data-lecture-5"><i class="fa fa-check"></i><b>5.2</b> Exercise 1: Analysis of the Active Time study data (lecture 5)</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="multilevel-modelling-practical-4-week-5.html"><a href="multilevel-modelling-practical-4-week-5.html#how-important-is-group-structure-vpcs-and-iccs"><i class="fa fa-check"></i><b>5.2.1</b> How important is group structure? (VPCs and ICCs)</a></li>
<li class="chapter" data-level="5.2.2" data-path="multilevel-modelling-practical-4-week-5.html"><a href="multilevel-modelling-practical-4-week-5.html#three-level-model-with-explanatory-variables"><i class="fa fa-check"></i><b>5.2.2</b> Three level Model with explanatory variables</a></li>
<li class="chapter" data-level="5.2.3" data-path="multilevel-modelling-practical-4-week-5.html"><a href="multilevel-modelling-practical-4-week-5.html#comparison-of-empty-model-with-model-with-explanatory-variables"><i class="fa fa-check"></i><b>5.2.3</b> Comparison of empty model with model with explanatory variables</a></li>
<li class="chapter" data-level="5.2.4" data-path="multilevel-modelling-practical-4-week-5.html"><a href="multilevel-modelling-practical-4-week-5.html#further-analysis-bottom-up-approach"><i class="fa fa-check"></i><b>5.2.4</b> Further analysis (bottom up approach)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="multilevel-modelling-practical-5-week-6.html"><a href="multilevel-modelling-practical-5-week-6.html"><i class="fa fa-check"></i><b>6</b> Multilevel Modelling Practical 5 (Week 6)</a>
<ul>
<li class="chapter" data-level="6.1" data-path="multilevel-modelling-practical-5-week-6.html"><a href="multilevel-modelling-practical-5-week-6.html#instructions---start-here"><i class="fa fa-check"></i><b>6.1</b> Instructions - start here!</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="multilevel-modelling-practical-5-week-6.html"><a href="multilevel-modelling-practical-5-week-6.html#overview"><i class="fa fa-check"></i><b>6.1.1</b> Overview</a></li>
<li class="chapter" data-level="6.1.2" data-path="multilevel-modelling-practical-5-week-6.html"><a href="multilevel-modelling-practical-5-week-6.html#multilevel-modelling-with-longitudinal-data"><i class="fa fa-check"></i><b>6.1.2</b> Multilevel modelling with longitudinal data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="multilevel-modelling-practical-6-week-7.html"><a href="multilevel-modelling-practical-6-week-7.html"><i class="fa fa-check"></i><b>7</b> Multilevel Modelling Practical 6 (Week 7)</a>
<ul>
<li class="chapter" data-level="7.1" data-path="multilevel-modelling-practical-6-week-7.html"><a href="multilevel-modelling-practical-6-week-7.html#instructions---start-here-1"><i class="fa fa-check"></i><b>7.1</b> Instructions - start here!</a></li>
<li class="chapter" data-level="7.2" data-path="multilevel-modelling-practical-6-week-7.html"><a href="multilevel-modelling-practical-6-week-7.html#exercise-1-long-and-wide-data-shape"><i class="fa fa-check"></i><b>7.2</b> Exercise 1 (Long and wide data shape)</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="multilevel-modelling-practical-6-week-7.html"><a href="multilevel-modelling-practical-6-week-7.html#regression-vs-multilevel-analysis"><i class="fa fa-check"></i><b>7.2.1</b> Regression vs multilevel analysis</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="multilevel-modelling-practical-6-week-7.html"><a href="multilevel-modelling-practical-6-week-7.html#exercise-2-simulation-from-the-two-level-longitudinal-model"><i class="fa fa-check"></i><b>7.3</b> Exercise 2 (simulation from the two-level longitudinal model)</a></li>
<li class="chapter" data-level="7.4" data-path="multilevel-modelling-practical-6-week-7.html"><a href="multilevel-modelling-practical-6-week-7.html#end-of-lab"><i class="fa fa-check"></i><b>7.4</b> End of lab!</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="multilevel-modelling-practical-7-week-8.html"><a href="multilevel-modelling-practical-7-week-8.html"><i class="fa fa-check"></i><b>8</b> Multilevel Modelling Practical 7 (Week 8)</a>
<ul>
<li class="chapter" data-level="8.1" data-path="multilevel-modelling-practical-7-week-8.html"><a href="multilevel-modelling-practical-7-week-8.html#instructions---start-here-2"><i class="fa fa-check"></i><b>8.1</b> Instructions - start here!</a></li>
<li class="chapter" data-level="8.2" data-path="multilevel-modelling-practical-7-week-8.html"><a href="multilevel-modelling-practical-7-week-8.html#exercise-1-aids-data-example-2-from-lecture-7"><i class="fa fa-check"></i><b>8.2</b> Exercise 1 (Aids data: Example 2 from lecture 7)</a></li>
<li class="chapter" data-level="8.3" data-path="multilevel-modelling-practical-7-week-8.html"><a href="multilevel-modelling-practical-7-week-8.html#exercise-2-leukaemia-data-example-3-from-lecture-7"><i class="fa fa-check"></i><b>8.3</b> Exercise 2 (Leukaemia data: Example 3 from lecture 7)</a></li>
<li class="chapter" data-level="8.4" data-path="multilevel-modelling-practical-7-week-8.html"><a href="multilevel-modelling-practical-7-week-8.html#exercise-3-toxoplasmosis-data-binomial-logistic-regression"><i class="fa fa-check"></i><b>8.4</b> Exercise 3: Toxoplasmosis data (Binomial logistic regression)</a></li>
<li class="chapter" data-level="8.5" data-path="multilevel-modelling-practical-7-week-8.html"><a href="multilevel-modelling-practical-7-week-8.html#end-of-lab-1"><i class="fa fa-check"></i><b>8.5</b> ## End of lab!</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="multilevel-modelling-practical-8-week-9.html"><a href="multilevel-modelling-practical-8-week-9.html"><i class="fa fa-check"></i><b>9</b> Multilevel Modelling Practical 8 (Week 9)</a>
<ul>
<li class="chapter" data-level="9.1" data-path="multilevel-modelling-practical-8-week-9.html"><a href="multilevel-modelling-practical-8-week-9.html#instructions---start-here-3"><i class="fa fa-check"></i><b>9.1</b> Instructions - start here!</a></li>
<li class="chapter" data-level="9.2" data-path="multilevel-modelling-practical-8-week-9.html"><a href="multilevel-modelling-practical-8-week-9.html#preliminaries"><i class="fa fa-check"></i><b>9.2</b> Preliminaries</a></li>
<li class="chapter" data-level="9.3" data-path="multilevel-modelling-practical-8-week-9.html"><a href="multilevel-modelling-practical-8-week-9.html#exercise-1-betablocker-data"><i class="fa fa-check"></i><b>9.3</b> Exercise 1: Betablocker data</a></li>
<li class="chapter" data-level="9.4" data-path="multilevel-modelling-practical-8-week-9.html"><a href="multilevel-modelling-practical-8-week-9.html#exercise-2-digging-deeper"><i class="fa fa-check"></i><b>9.4</b> Exercise 2 (digging deeper)</a></li>
<li class="chapter" data-level="9.5" data-path="multilevel-modelling-practical-8-week-9.html"><a href="multilevel-modelling-practical-8-week-9.html#exercise-3-optional-toxoplasmosis-data-revisited"><i class="fa fa-check"></i><b>9.5</b> Exercise 3 (optional): Toxoplasmosis data revisited</a></li>
<li class="chapter" data-level="9.6" data-path="multilevel-modelling-practical-8-week-9.html"><a href="multilevel-modelling-practical-8-week-9.html#summative-assessment"><i class="fa fa-check"></i><b>9.6</b> Summative assessment</a></li>
<li class="chapter" data-level="9.7" data-path="multilevel-modelling-practical-8-week-9.html"><a href="multilevel-modelling-practical-8-week-9.html#end-of-lab-2"><i class="fa fa-check"></i><b>9.7</b> ## End of lab!</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="multilevel-modelling-practical-9-week-10.html"><a href="multilevel-modelling-practical-9-week-10.html"><i class="fa fa-check"></i><b>10</b> Multilevel Modelling Practical 9 (Week 10)</a>
<ul>
<li class="chapter" data-level="10.1" data-path="multilevel-modelling-practical-9-week-10.html"><a href="multilevel-modelling-practical-9-week-10.html#dealing-with-missing-values"><i class="fa fa-check"></i><b>10.1</b> Dealing with missing values</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="multilevel-modelling-practical-1-week-2" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Multilevel Modelling Practical 1 (Week 2)<a href="multilevel-modelling-practical-1-week-2.html#multilevel-modelling-practical-1-week-2" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="instructions-start-here" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Instructions – start here!<a href="multilevel-modelling-practical-1-week-2.html#instructions-start-here" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The first part of this notebook (<strong>Exercise 1</strong>) takes you through a simple linear regression (using simulated data).</p>
<p>The second part of the notebook (<strong>Exercise 2</strong>) involves a multiple linear regression analysis of hourly wage data.</p>
</div>
<div id="exercises-1" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Exercises 1<a href="multilevel-modelling-practical-1-week-2.html#exercises-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Copy and paste the following code chunk which generates pairs <span class="math inline">\((x_1,y_1), (x_2,y_2),\ldots,(x_n,y_n)\)</span> where <span class="math inline">\(n=200\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="multilevel-modelling-practical-1-week-2.html#cb2-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">43515</span>) <span class="co"># for reproducibility</span></span>
<span id="cb2-2"><a href="multilevel-modelling-practical-1-week-2.html#cb2-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb2-3"><a href="multilevel-modelling-practical-1-week-2.html#cb2-3" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb2-4"><a href="multilevel-modelling-practical-1-week-2.html#cb2-4" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">+</span><span class="dv">3</span><span class="sc">*</span>x<span class="sc">+</span><span class="fu">rnorm</span>(n,<span class="dv">0</span>,<span class="dv">1</span>)</span></code></pre></div>
<p>We can visualise the data with a scatterplot:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="multilevel-modelling-practical-1-week-2.html#cb3-1" tabindex="-1"></a><span class="fu">plot</span>(x,y,<span class="at">main=</span><span class="st">&quot;Scatterplot&quot;</span>)</span></code></pre></div>
<p><img src="MLM_worksheets_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p><br></p>
<ol style="list-style-type: decimal">
<li>What distribution are the <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> values simulated from? Do histograms of <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> values match your answer?</li>
</ol>
<details>
<summary>
Click for solution
</summary>
<p>Let <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> be the random variables that the <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> values are simulations of (respectively). We have that <span class="math inline">\(X\sim N(0,1)\)</span> and <span class="math inline">\(Y|X=x \sim N(2+3x,1)\)</span>. Hence <span class="math inline">\(Y\sim N(2,3^2+1^2)\equiv N(2,10)\)</span>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="multilevel-modelling-practical-1-week-2.html#cb4-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb4-2"><a href="multilevel-modelling-practical-1-week-2.html#cb4-2" tabindex="-1"></a><span class="fu">hist</span>(x,<span class="at">freq=</span><span class="cn">FALSE</span>)</span>
<span id="cb4-3"><a href="multilevel-modelling-practical-1-week-2.html#cb4-3" tabindex="-1"></a><span class="fu">hist</span>(y,<span class="at">freq=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="MLM_worksheets_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
Histograms are symmetric about 0 and 2, with most values between <span class="math inline">\(-3\)</span> and <span class="math inline">\(+3\)</span> (mean plus/minus 3 standard deviations) for <span class="math inline">\(x\)</span>, and between <span class="math inline">\(-7\)</span> and <span class="math inline">\(+11\)</span> for <span class="math inline">\(y\)</span> (mean plus/minus roughly 3 standard deviations).
</details>
<p><br></p>
<ol start="2" style="list-style-type: decimal">
<li>Calculate the Pearson correlation coefficient. How does this compare to the theoretical correlation? (Hint: recall that <span class="math inline">\(Cov(X,a+bX)=Cov(X,a)+Cov(X,bX)=bCov(X,X)=bVar(X)\)</span> for constants <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>.)</li>
</ol>
<details>
<summary>
Click for solution
</summary>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="multilevel-modelling-practical-1-week-2.html#cb5-1" tabindex="-1"></a>(r.pearson <span class="ot">&lt;-</span> <span class="fu">cor</span>(x,y))</span></code></pre></div>
<pre><code>## [1] 0.9310128</code></pre>
<p>The theoretical covariance is <span class="math inline">\(Cov(X,Y)=Cov(X,2+3X)=3Var(X)=3\)</span>. Hence, the theoretical correlation between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> is <span class="math inline">\(3/\sqrt{Var(X)Var(Y)}=3/ \sqrt{10}=0.95\)</span>.</p>
</details>
<p><br></p>
<p>We can fit a linear regression model to these data and summarise the output via</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="multilevel-modelling-practical-1-week-2.html#cb7-1" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x)</span>
<span id="cb7-2"><a href="multilevel-modelling-practical-1-week-2.html#cb7-2" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.6323 -0.6375 -0.0632  0.6329  2.9024 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  1.99094    0.07455   26.71   &lt;2e-16 ***
## x            2.92914    0.08161   35.89   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.054 on 198 degrees of freedom
## Multiple R-squared:  0.8668, Adjusted R-squared:  0.8661 
## F-statistic:  1288 on 1 and 198 DF,  p-value: &lt; 2.2e-16</code></pre>
<p><br></p>
<ol start="3" style="list-style-type: decimal">
<li>Interpret this output. (At least three comments expected here!)</li>
</ol>
<details>
<summary>
Click for solution
</summary>
<ul>
<li>The estimates of the intercept <span class="math inline">\(b_0\)</span> and slope <span class="math inline">\(b_1\)</span> are in agreement with the ground truth values that generated the data (<span class="math inline">\(\beta_0=2\)</span>, <span class="math inline">\(\beta_1=3\)</span>).</li>
<li>Unsurprisingly, the t-test of the null hypothesis that <span class="math inline">\(H_0:\beta_1=0\)</span> suggests strong evidence against the null: it appears that the slope is needed. The F-test gives the same conclusion.</li>
<li>The coefficient of determination is <span class="math inline">\(R^2=0.8668\)</span> suggesting that almost 90% of the variation in <span class="math inline">\(Y\)</span> is being explained by the regression on <span class="math inline">\(x\)</span>. Note that</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="multilevel-modelling-practical-1-week-2.html#cb9-1" tabindex="-1"></a>(r.pearson<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 0.8667848</code></pre>
gives <span class="math inline">\(R^2\)</span>.
</details>
<p><br></p>
<ol start="4" style="list-style-type: decimal">
<li>Reproduce the scatterplot and overlay the regression line. (Hint: recall the <code>abline()</code> function and note that <code>coef(model)</code> gives the estimated intercept and slope.)</li>
</ol>
<details>
<summary>
Click for solution
</summary>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="multilevel-modelling-practical-1-week-2.html#cb11-1" tabindex="-1"></a><span class="fu">plot</span>(x,y)</span>
<span id="cb11-2"><a href="multilevel-modelling-practical-1-week-2.html#cb11-2" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">coef</span>(model))</span></code></pre></div>
<img src="MLM_worksheets_files/figure-html/unnamed-chunk-7-1.png" width="672" />
</details>
<p><br></p>
<p>In what follows, it will be helpful to work with sorted (in increasing order) values of <span class="math inline">\(x\)</span> and the associated values of <span class="math inline">\(y\)</span>. Hence execute the following code (and try to understand it):</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="multilevel-modelling-practical-1-week-2.html#cb12-1" tabindex="-1"></a>ind <span class="ot">&lt;-</span> <span class="fu">sort</span>(x,<span class="at">index.return=</span><span class="cn">TRUE</span>)</span>
<span id="cb12-2"><a href="multilevel-modelling-practical-1-week-2.html#cb12-2" tabindex="-1"></a>x <span class="ot">&lt;-</span> x[ind<span class="sc">$</span>ix]</span>
<span id="cb12-3"><a href="multilevel-modelling-practical-1-week-2.html#cb12-3" tabindex="-1"></a>y <span class="ot">&lt;-</span> y[ind<span class="sc">$</span>ix]</span>
<span id="cb12-4"><a href="multilevel-modelling-practical-1-week-2.html#cb12-4" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x)</span></code></pre></div>
<p>Recall that the <code>predict()</code> function can be used to generate fitted values <span class="math inline">\(\hat{y}_i\)</span>, confidence and prediction intervals. The following code generates fitted values and the lower / upper limits of a 95% confidence interval for the mean response <span class="math inline">\(\beta_0+\beta_1 x_i\)</span>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="multilevel-modelling-practical-1-week-2.html#cb13-1" tabindex="-1"></a>fit.y <span class="ot">&lt;-</span> <span class="fu">predict</span>(model,<span class="at">newdata =</span> <span class="fu">data.frame</span>(x),<span class="at">interval =</span> <span class="st">&quot;confidence&quot;</span>)</span>
<span id="cb13-2"><a href="multilevel-modelling-practical-1-week-2.html#cb13-2" tabindex="-1"></a><span class="fu">head</span>(fit.y) <span class="co">#inspect first few rows</span></span></code></pre></div>
<pre><code>##         fit       lwr       upr
## 1 -4.607650 -5.003545 -4.211755
## 2 -4.527100 -4.918888 -4.135311
## 3 -4.161157 -4.534383 -3.787930
## 4 -3.768590 -4.122093 -3.415088
## 5 -3.516371 -3.857319 -3.175424
## 6 -3.055568 -3.373856 -2.737279</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Overlay (in red) on your plot from part 4 the 95% confidence interval for the expected response <span class="math inline">\(\beta_0+\beta_1 x_i\)</span> for each <span class="math inline">\(x_i\)</span>. (Hint: <code>lines()</code> will be useful here.)</li>
</ol>
<details>
<summary>
Click for solution
</summary>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="multilevel-modelling-practical-1-week-2.html#cb15-1" tabindex="-1"></a><span class="fu">plot</span>(x,y)</span>
<span id="cb15-2"><a href="multilevel-modelling-practical-1-week-2.html#cb15-2" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">coef</span>(model))</span>
<span id="cb15-3"><a href="multilevel-modelling-practical-1-week-2.html#cb15-3" tabindex="-1"></a><span class="fu">lines</span>(x,fit.y[,<span class="dv">2</span>],<span class="at">type=</span><span class="st">&quot;l&quot;</span>,<span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb15-4"><a href="multilevel-modelling-practical-1-week-2.html#cb15-4" tabindex="-1"></a><span class="fu">lines</span>(x,fit.y[,<span class="dv">3</span>],<span class="at">type=</span><span class="st">&quot;l&quot;</span>,<span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<img src="MLM_worksheets_files/figure-html/unnamed-chunk-10-1.png" width="672" />
</details>
<p><br></p>
<ol start="6" style="list-style-type: decimal">
<li>By using the <code>predict()</code> function with <code>interval = "prediction"</code>, overlay (in green) on your plot from part 5 the 95% prediction interval for each <span class="math inline">\(y_i\)</span>. Comment.</li>
</ol>
<details>
<summary>
Click for solution
</summary>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="multilevel-modelling-practical-1-week-2.html#cb16-1" tabindex="-1"></a>fit.yp <span class="ot">&lt;-</span> <span class="fu">predict</span>(model,<span class="at">newdata =</span> <span class="fu">data.frame</span>(x),<span class="at">interval =</span> <span class="st">&quot;prediction&quot;</span>)</span>
<span id="cb16-2"><a href="multilevel-modelling-practical-1-week-2.html#cb16-2" tabindex="-1"></a><span class="fu">plot</span>(x,y)</span>
<span id="cb16-3"><a href="multilevel-modelling-practical-1-week-2.html#cb16-3" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">coef</span>(model))</span>
<span id="cb16-4"><a href="multilevel-modelling-practical-1-week-2.html#cb16-4" tabindex="-1"></a><span class="fu">lines</span>(x,fit.y[,<span class="dv">2</span>],<span class="at">type=</span><span class="st">&quot;l&quot;</span>,<span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb16-5"><a href="multilevel-modelling-practical-1-week-2.html#cb16-5" tabindex="-1"></a><span class="fu">lines</span>(x,fit.y[,<span class="dv">3</span>],<span class="at">type=</span><span class="st">&quot;l&quot;</span>,<span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb16-6"><a href="multilevel-modelling-practical-1-week-2.html#cb16-6" tabindex="-1"></a><span class="fu">lines</span>(x,fit.yp[,<span class="dv">2</span>],<span class="at">type=</span><span class="st">&quot;l&quot;</span>,<span class="at">col=</span><span class="st">&quot;green&quot;</span>)</span>
<span id="cb16-7"><a href="multilevel-modelling-practical-1-week-2.html#cb16-7" tabindex="-1"></a><span class="fu">lines</span>(x,fit.yp[,<span class="dv">3</span>],<span class="at">type=</span><span class="st">&quot;l&quot;</span>,<span class="at">col=</span><span class="st">&quot;green&quot;</span>)</span></code></pre></div>
<p><img src="MLM_worksheets_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
The prediction interval is wider than the confidence interval, as expected (recall that the prediction interval takes into account the variance of the error term).
</details>
<p><br></p>
<ol start="7" style="list-style-type: decimal">
<li>Check the regression assumptions of <code>model</code>.</li>
</ol>
<details>
<summary>
Click for solution
</summary>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="multilevel-modelling-practical-1-week-2.html#cb17-1" tabindex="-1"></a><span class="fu">plot</span>(model)</span></code></pre></div>
<p><img src="MLM_worksheets_files/figure-html/unnamed-chunk-12-1.png" width="672" /><img src="MLM_worksheets_files/figure-html/unnamed-chunk-12-2.png" width="672" /><img src="MLM_worksheets_files/figure-html/unnamed-chunk-12-3.png" width="672" /><img src="MLM_worksheets_files/figure-html/unnamed-chunk-12-4.png" width="672" /></p>
The Q-Q plots suggests that the normality assumption is reasonable. Plots of the residuals against fitted values show no obvious pattern (i.e. no fanning out; the constant variance assumption appears reasonable, and no systematic shape; the linear relationship between response and predictors appears reasonable). The last plot indicates some outliers but these do not appear to be of high leverage (according to Cook’s distance) so it is not necessary to remove them. All of these comments are as expected since we’ve simulated the data from a simpler linear regression model so we’d be surprised if it didn’t fit well!
</details>
<p><br></p>
<ol start="8" style="list-style-type: decimal">
<li>Let’s add an outlying data point to our synthetic data set and look at the resulting scatter plot:</li>
</ol>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="multilevel-modelling-practical-1-week-2.html#cb18-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(x,<span class="dv">0</span>)</span>
<span id="cb18-2"><a href="multilevel-modelling-practical-1-week-2.html#cb18-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(y, <span class="dv">15</span>)</span>
<span id="cb18-3"><a href="multilevel-modelling-practical-1-week-2.html#cb18-3" tabindex="-1"></a><span class="fu">plot</span>(x,y,<span class="at">main=</span><span class="st">&quot;Scatter plot with outlier&quot;</span>)</span></code></pre></div>
<p><img src="MLM_worksheets_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Fit the simple regression model again (call it <code>model_out1</code>) and check the assumptions. What do you notice?</p>
<details>
<summary>
Click for solution
</summary>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="multilevel-modelling-practical-1-week-2.html#cb19-1" tabindex="-1"></a>model_out1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x)</span>
<span id="cb19-2"><a href="multilevel-modelling-practical-1-week-2.html#cb19-2" tabindex="-1"></a><span class="fu">plot</span>(model_out1)</span></code></pre></div>
<p><img src="MLM_worksheets_files/figure-html/unnamed-chunk-14-1.png" width="672" /><img src="MLM_worksheets_files/figure-html/unnamed-chunk-14-2.png" width="672" /><img src="MLM_worksheets_files/figure-html/unnamed-chunk-14-3.png" width="672" /><img src="MLM_worksheets_files/figure-html/unnamed-chunk-14-4.png" width="672" /></p>
<p>The assumptions look reasonable. The outlier is not influential (Cook’s distance is less than 1 for the outlier). In fact, we can see that the outlier appears to have almost no affect on the line of best fit, whether it’s included or not.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="multilevel-modelling-practical-1-week-2.html#cb20-1" tabindex="-1"></a><span class="fu">plot</span>(x,y)</span>
<span id="cb20-2"><a href="multilevel-modelling-practical-1-week-2.html#cb20-2" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">coef</span>(model_out1))</span>
<span id="cb20-3"><a href="multilevel-modelling-practical-1-week-2.html#cb20-3" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">coef</span>(model),<span class="at">col=</span><span class="dv">2</span>) <span class="co">#least squares line without the outlier</span></span></code></pre></div>
<p><img src="MLM_worksheets_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
</details>
<p><br></p>
<ol start="9" style="list-style-type: decimal">
<li>Let’s add another outlying data point to our synthetic data set and look at the resulting scatter plot:</li>
</ol>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="multilevel-modelling-practical-1-week-2.html#cb21-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(x,<span class="dv">3</span>)</span>
<span id="cb21-2"><a href="multilevel-modelling-practical-1-week-2.html#cb21-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(y, <span class="dv">30</span>)</span>
<span id="cb21-3"><a href="multilevel-modelling-practical-1-week-2.html#cb21-3" tabindex="-1"></a><span class="fu">plot</span>(x,y,<span class="at">main=</span><span class="st">&quot;Scatter plot with two outliers&quot;</span>)</span></code></pre></div>
<p><img src="MLM_worksheets_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>Fit the simple regression model again (call it <code>model_out2</code>) and check the assumptions. What do you notice?</p>
<details>
<summary>
Click for solution
</summary>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="multilevel-modelling-practical-1-week-2.html#cb22-1" tabindex="-1"></a>model_out2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x)</span>
<span id="cb22-2"><a href="multilevel-modelling-practical-1-week-2.html#cb22-2" tabindex="-1"></a><span class="fu">plot</span>(model_out2)</span></code></pre></div>
<p><img src="MLM_worksheets_files/figure-html/unnamed-chunk-17-1.png" width="672" /><img src="MLM_worksheets_files/figure-html/unnamed-chunk-17-2.png" width="672" /><img src="MLM_worksheets_files/figure-html/unnamed-chunk-17-3.png" width="672" /><img src="MLM_worksheets_files/figure-html/unnamed-chunk-17-4.png" width="672" /></p>
<p>The second outlier has high leverage (Cook’s distance greater than 1). In fact, you can see the effect of including it in the data set via:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="multilevel-modelling-practical-1-week-2.html#cb23-1" tabindex="-1"></a><span class="fu">plot</span>(x,y)</span>
<span id="cb23-2"><a href="multilevel-modelling-practical-1-week-2.html#cb23-2" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">coef</span>(model_out2))</span>
<span id="cb23-3"><a href="multilevel-modelling-practical-1-week-2.html#cb23-3" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">coef</span>(model),<span class="at">col=</span><span class="dv">2</span>) <span class="co">#least squares line without the outlier</span></span></code></pre></div>
<p><img src="MLM_worksheets_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
The line of best fit obtained with the (second) outlier included in the data, has a larger slope coefficient than that obtained without the (second) outlier.
</details>
<p><br></p>
</div>
<div id="exercises-2" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Exercises 2<a href="multilevel-modelling-practical-1-week-2.html#exercises-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This exercise concerns the data set <code>hwages</code> consisting of 534 observations on 7 variables. We will focus on the following variables:</p>
<ul>
<li><code>wages</code> - hourly wage (in dollars). We will treat this as the response.</li>
<li><code>workexp</code> - work experience in years.</li>
<li><code>education</code> - schooling in years.</li>
<li><code>sector</code> - 0 for private and 1 for public (e.g. hospital, school etc).</li>
</ul>
<p>Read in the data from Andy’s Github page with</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="multilevel-modelling-practical-1-week-2.html#cb24-1" tabindex="-1"></a>hwages <span class="ot">&lt;-</span> </span>
<span id="cb24-2"><a href="multilevel-modelling-practical-1-week-2.html#cb24-2" tabindex="-1"></a>   <span class="fu">read.csv</span>(<span class="at">file=</span><span class="st">&quot;https://andygolightly.github.io/teaching/MATH43515/hwages.csv&quot;</span>)</span></code></pre></div>
<p>Let’s also explicitly store the columns we will need as separate variables:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="multilevel-modelling-practical-1-week-2.html#cb25-1" tabindex="-1"></a>data <span class="ot">&lt;-</span> hwages </span>
<span id="cb25-2"><a href="multilevel-modelling-practical-1-week-2.html#cb25-2" tabindex="-1"></a>wages <span class="ot">&lt;-</span> data<span class="sc">$</span>wages <span class="co">#response / dependent variable</span></span>
<span id="cb25-3"><a href="multilevel-modelling-practical-1-week-2.html#cb25-3" tabindex="-1"></a>workexp <span class="ot">&lt;-</span> data<span class="sc">$</span>workexp </span>
<span id="cb25-4"><a href="multilevel-modelling-practical-1-week-2.html#cb25-4" tabindex="-1"></a>educ <span class="ot">&lt;-</span> data<span class="sc">$</span>education </span>
<span id="cb25-5"><a href="multilevel-modelling-practical-1-week-2.html#cb25-5" tabindex="-1"></a>sector <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data<span class="sc">$</span>sector)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Plot a histogram of the dependent variable (<code>wages</code>). Do you see any skewness? Is this a problem?</li>
</ol>
<details>
<summary>
Click for solution
</summary>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="multilevel-modelling-practical-1-week-2.html#cb26-1" tabindex="-1"></a><span class="fu">hist</span>(wages,<span class="at">main=</span><span class="st">&quot;Histogram of wages (dollars per hour)&quot;</span>)</span></code></pre></div>
<p><img src="MLM_worksheets_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
Indeed there is some skewness although this is not necessarily a problem. A skewed dependent variable does not violate any assumptions since we require normality of residuals, not variables.
</details>
<p><br></p>
<p>Let’s transform the response variable via the natural logarithm:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="multilevel-modelling-practical-1-week-2.html#cb27-1" tabindex="-1"></a>lwages <span class="ot">&lt;-</span> <span class="fu">log</span>(wages)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>How does a histogram of <code>lwages</code> compare to that in part 1?</li>
</ol>
<details>
<summary>
Click for solution
</summary>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="multilevel-modelling-practical-1-week-2.html#cb28-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb28-2"><a href="multilevel-modelling-practical-1-week-2.html#cb28-2" tabindex="-1"></a><span class="fu">hist</span>(wages,<span class="at">main=</span><span class="st">&quot;wages&quot;</span>)</span>
<span id="cb28-3"><a href="multilevel-modelling-practical-1-week-2.html#cb28-3" tabindex="-1"></a><span class="fu">hist</span>(lwages,<span class="at">main=</span><span class="st">&quot;ln wages&quot;</span>)</span></code></pre></div>
<p><img src="MLM_worksheets_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
The right skew appears to be alleviated by the transformation.
</details>
<p><br></p>
<ol start="3" style="list-style-type: decimal">
<li>Denote by <span class="math inline">\(y_i\)</span> the value of the <strong>log wage</strong> for person <span class="math inline">\(i\)</span>. Fit the model</li>
</ol>
<p><span class="math display">\[ Y_i = \beta_0 + \beta_1 \textrm{education}_i + \beta_2 \textrm{sector}_i + \epsilon_i, \quad i=1,\ldots,n \]</span>
with the result stored in <code>model1</code>. What do the results suggest for the predicted public sector hourly wage vs private? Hint: use <code>lm()</code> and <code>summary()</code>. Be careful with the interpretation - recall that the response is the natural logarithm of hourly wage.</p>
<details>
<summary>
Click for solution
</summary>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="multilevel-modelling-practical-1-week-2.html#cb29-1" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(lwages<span class="sc">~</span>educ<span class="sc">+</span>sector)</span>
<span id="cb29-2"><a href="multilevel-modelling-practical-1-week-2.html#cb29-2" tabindex="-1"></a><span class="fu">summary</span>(model1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = lwages ~ educ + sector)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -2.08737 -0.35123  0.03087  0.33134  1.78649 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  1.165192   0.106130  10.979   &lt;2e-16 ***
## educ         0.076848   0.007867   9.768   &lt;2e-16 ***
## sector1     -0.232067   0.041254  -5.625    3e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.475 on 531 degrees of freedom
## Multiple R-squared:  0.1928, Adjusted R-squared:  0.1898 
## F-statistic: 63.42 on 2 and 531 DF,  p-value: &lt; 2.2e-16</code></pre>
We see that the estimate of the variable <code>sector</code> is <span class="math inline">\(-0.232\)</span>. Hence, with the <code>educ</code> variable held constant, the model suggests that average hourly log wages are reduced by <span class="math inline">\(-0.232\)</span> for public sector workers. Hence, actual average hourly wage is reduced by a (multiplicative) factor of <span class="math inline">\((1-\exp(-0.232))\times 100=20\%\)</span>.
</details>
<p><br></p>
<ol start="4" style="list-style-type: decimal">
<li>We can set up functions to evaluate the equations of the two lines (one for <code>sector=0</code> and one for <code>sector=1</code>) as functions of the variable <code>educ</code> as follows:</li>
</ol>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="multilevel-modelling-practical-1-week-2.html#cb31-1" tabindex="-1"></a>eq1 <span class="ot">&lt;-</span> <span class="cf">function</span>(educ){<span class="fu">coef</span>(model1)[<span class="dv">1</span>]<span class="sc">+</span><span class="fu">coef</span>(model1)[<span class="dv">2</span>]<span class="sc">*</span>educ} <span class="co">#private sector</span></span>
<span id="cb31-2"><a href="multilevel-modelling-practical-1-week-2.html#cb31-2" tabindex="-1"></a>eq2 <span class="ot">&lt;-</span> <span class="cf">function</span>(educ){<span class="fu">coef</span>(model1)[<span class="dv">1</span>]<span class="sc">+</span><span class="fu">coef</span>(model1)[<span class="dv">2</span>]<span class="sc">*</span>educ<span class="sc">+</span><span class="fu">coef</span>(model1)[<span class="dv">3</span>]} <span class="co">#public sector</span></span></code></pre></div>
<p>Overlay the fitted line by sector type on the scatterplot of <code>lwages</code> against <code>educ</code>. (Hint: first set up a vector of <code>x</code> values, e.g. using <code>seq()</code>, against which to plot the output of <code>eq1</code> and <code>eq2</code>.)</p>
<details>
<summary>
Click for solution
</summary>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="multilevel-modelling-practical-1-week-2.html#cb32-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(educ),<span class="fu">max</span>(educ),<span class="fl">0.1</span>) <span class="co">#set up educ values at which to evaluate line</span></span>
<span id="cb32-2"><a href="multilevel-modelling-practical-1-week-2.html#cb32-2" tabindex="-1"></a><span class="fu">plot</span>(educ,lwages)</span>
<span id="cb32-3"><a href="multilevel-modelling-practical-1-week-2.html#cb32-3" tabindex="-1"></a><span class="fu">lines</span>(x,<span class="fu">eq1</span>(x),<span class="at">type=</span><span class="st">&quot;l&quot;</span>,<span class="at">col=</span><span class="st">&quot;red&quot;</span>) <span class="co">#private</span></span>
<span id="cb32-4"><a href="multilevel-modelling-practical-1-week-2.html#cb32-4" tabindex="-1"></a><span class="fu">lines</span>(x,<span class="fu">eq2</span>(x),<span class="at">type=</span><span class="st">&quot;l&quot;</span>,<span class="at">col=</span><span class="st">&quot;green&quot;</span>) <span class="co">#public</span></span></code></pre></div>
<p><img src="MLM_worksheets_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
As expected, the lines have the same slope but the line for <code>sector=1</code> is shifted by the amount <span class="math inline">\(b_3=-0.232\)</span>.
</details>
<p><br></p>
<ol start="5" style="list-style-type: decimal">
<li>Add the variable named <code>workexp</code> to <code>model1</code> (that is, fit the multiple linear regression model with this additional predictor variable). Name the resulting model <code>model2</code>.</li>
</ol>
<details>
<summary>
Click for solution
</summary>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="multilevel-modelling-practical-1-week-2.html#cb33-1" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(lwages<span class="sc">~</span>educ<span class="sc">+</span>sector<span class="sc">+</span>workexp)</span></code></pre></div>
</details>
<p><br></p>
<ol start="6" style="list-style-type: decimal">
<li>Interpret the coefficients of <code>model2</code> in the context of both wage and log wage.</li>
</ol>
<details>
<summary>
Click for solution
</summary>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="multilevel-modelling-practical-1-week-2.html#cb34-1" tabindex="-1"></a><span class="fu">summary</span>(model2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = lwages ~ educ + sector + workexp)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -2.15504 -0.30764  0.00708  0.30955  1.99176 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  0.674929   0.120510   5.601 3.43e-08 ***
## educ         0.098006   0.008009  12.237  &lt; 2e-16 ***
## sector1     -0.255947   0.039409  -6.495 1.92e-10 ***
## workexp      0.012668   0.001697   7.466 3.42e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.4523 on 530 degrees of freedom
## Multiple R-squared:  0.2696, Adjusted R-squared:  0.2655 
## F-statistic: 65.22 on 3 and 530 DF,  p-value: &lt; 2.2e-16</code></pre>
We have that <span class="math inline">\(b_1=0.098\)</span>, <span class="math inline">\(b_2=-0.256\)</span> and <span class="math inline">\(b_3=0.013\)</span>. Hence, an additional year of schooling increases average log wage by 0.098 (with the other variables held constant). An additional year of work experience increases log wage by 0.013. The average hourly log wage for public sector workers appears to be 0.256 (log dollars) lower than for private sector workers. Working with log wages makes interpretation difficult. A better interpretation here is to look at the percentage increase or decrease resulting from a unit change in one variable (while keeping the others constant). For example, the percentage increase in average wage resulting from an additional year of schooling is <span class="math inline">\((\exp(0.098)-1)\times 100=10\%\)</span> (with the other variables held constant).
</details>
<p><br></p>
<ol start="7" style="list-style-type: decimal">
<li>What does the adjusted <span class="math inline">\(R^2\)</span> suggest about <code>model2</code> compared to <code>model1</code>?</li>
</ol>
<details>
<summary>
Click for solution
</summary>
The adjusted R-squared is 0.2655 for <code>model2</code> versus 0.1898 for <code>model1</code> suggesting a reasonable improvement in explained variation when moving to <code>model2</code>. These values are quite small though; only <span class="math inline">\(27\%\)</span> of the variation in the response is explained by the regression on <code>educ</code>, <code>sector</code> and <code>workexp</code> is not great from a performance perspective!
</details>
<p><br></p>
<ol start="8" style="list-style-type: decimal">
<li>Run the command <code>anova(model1, model2)</code>. Which model (<code>model1</code> or <code>model2</code>) is preferred?</li>
</ol>
<details>
<summary>
Click for solution
</summary>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="multilevel-modelling-practical-1-week-2.html#cb36-1" tabindex="-1"></a><span class="fu">anova</span>(model1, model2)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: lwages ~ educ + sector
## Model 2: lwages ~ educ + sector + workexp
##   Res.Df    RSS Df Sum of Sq      F    Pr(&gt;F)    
## 1    531 119.83                                  
## 2    530 108.42  1    11.403 55.743 3.417e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
We see that the test statistic is large (much bigger than 1) and the p-value is very small (certainly much smaller than 5%) suggesting strong evidence against the null hypothesis that the larger model offers no improvement in fit compared to the simpler model. The conclusion is that the additional <code>workexp</code> variable is needed.
</details>
<p><br></p>
<ol start="9" style="list-style-type: decimal">
<li>Check the regression assumptions of <code>model2</code>.</li>
</ol>
<details>
<summary>
Click for solution
</summary>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="multilevel-modelling-practical-1-week-2.html#cb38-1" tabindex="-1"></a><span class="fu">plot</span>(model2)</span></code></pre></div>
<p><img src="MLM_worksheets_files/figure-html/unnamed-chunk-30-1.png" width="672" /><img src="MLM_worksheets_files/figure-html/unnamed-chunk-30-2.png" width="672" /><img src="MLM_worksheets_files/figure-html/unnamed-chunk-30-3.png" width="672" /><img src="MLM_worksheets_files/figure-html/unnamed-chunk-30-4.png" width="672" /></p>
The Q-Q plots suggests that the normality assumption is reasonable. Plots of the residuals against fitted values show no obvious pattern (i.e. no fanning out; the constant variance assumption appears reasonable, and no systematic shape; the linear relationship between log wages and predictors appears reasonable). The last plot indicates some outliers but these do not appear to be of high leverage (according to Cook’s distance) so it is not necessary to remove them.
</details>
<p><br></p>
<p><br></p>
<p>End of lab!</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="multilevel-modelling-practical-2-week-3.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
},
"sidebar": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
