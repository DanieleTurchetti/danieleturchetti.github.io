<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>10 Multilevel Modelling Practical 9 (Week 10) | MLM_worksheets.knit</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="10 Multilevel Modelling Practical 9 (Week 10) | MLM_worksheets.knit" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10 Multilevel Modelling Practical 9 (Week 10) | MLM_worksheets.knit" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="multilevel-modelling-practical-8-week-9.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Home</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome to multilevel modelling</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#including-plots"><i class="fa fa-check"></i><b>1.1</b> Including Plots</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="multilevel-modelling-practical-1-week-2.html"><a href="multilevel-modelling-practical-1-week-2.html"><i class="fa fa-check"></i><b>2</b> Multilevel Modelling Practical 1 (Week 2)</a>
<ul>
<li class="chapter" data-level="2.1" data-path="multilevel-modelling-practical-1-week-2.html"><a href="multilevel-modelling-practical-1-week-2.html#instructions-start-here"><i class="fa fa-check"></i><b>2.1</b> Instructions – start here!</a></li>
<li class="chapter" data-level="2.2" data-path="multilevel-modelling-practical-1-week-2.html"><a href="multilevel-modelling-practical-1-week-2.html#exercises-1"><i class="fa fa-check"></i><b>2.2</b> Exercises 1</a></li>
<li class="chapter" data-level="2.3" data-path="multilevel-modelling-practical-1-week-2.html"><a href="multilevel-modelling-practical-1-week-2.html#exercises-2"><i class="fa fa-check"></i><b>2.3</b> Exercises 2</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="multilevel-modelling-practical-2-week-3.html"><a href="multilevel-modelling-practical-2-week-3.html"><i class="fa fa-check"></i><b>3</b> Multilevel Modelling Practical 2 (Week 3)</a>
<ul>
<li class="chapter" data-level="3.1" data-path="multilevel-modelling-practical-2-week-3.html"><a href="multilevel-modelling-practical-2-week-3.html#instructions-start-here-1"><i class="fa fa-check"></i><b>3.1</b> Instructions – start here!</a></li>
<li class="chapter" data-level="3.2" data-path="multilevel-modelling-practical-2-week-3.html"><a href="multilevel-modelling-practical-2-week-3.html#exercises-1-1"><i class="fa fa-check"></i><b>3.2</b> Exercises 1</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="multilevel-modelling-practical-2-week-3.html"><a href="multilevel-modelling-practical-2-week-3.html#acquire-and-prepare-data"><i class="fa fa-check"></i><b>3.2.1</b> Acquire and prepare data</a></li>
<li class="chapter" data-level="3.2.2" data-path="multilevel-modelling-practical-2-week-3.html"><a href="multilevel-modelling-practical-2-week-3.html#exploratory-analysis"><i class="fa fa-check"></i><b>3.2.2</b> Exploratory analysis</a></li>
<li class="chapter" data-level="3.2.3" data-path="multilevel-modelling-practical-2-week-3.html"><a href="multilevel-modelling-practical-2-week-3.html#naive-simple-linear-regression-models"><i class="fa fa-check"></i><b>3.2.3</b> Naive simple linear regression models</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="multilevel-modelling-practical-2-week-3.html"><a href="multilevel-modelling-practical-2-week-3.html#exercise-2"><i class="fa fa-check"></i><b>3.3</b> Exercise 2</a></li>
<li class="chapter" data-level="3.4" data-path="multilevel-modelling-practical-2-week-3.html"><a href="multilevel-modelling-practical-2-week-3.html#exercise-3-if-time"><i class="fa fa-check"></i><b>3.4</b> Exercise 3 (if time)</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="multilevel-modelling-practical-3-week-4.html"><a href="multilevel-modelling-practical-3-week-4.html"><i class="fa fa-check"></i><b>4</b> Multilevel Modelling Practical 3 (Week 4)</a>
<ul>
<li class="chapter" data-level="4.1" data-path="multilevel-modelling-practical-3-week-4.html"><a href="multilevel-modelling-practical-3-week-4.html#instructions-start-here-2"><i class="fa fa-check"></i><b>4.1</b> Instructions – start here!</a></li>
<li class="chapter" data-level="4.2" data-path="multilevel-modelling-practical-3-week-4.html"><a href="multilevel-modelling-practical-3-week-4.html#exercise-1"><i class="fa fa-check"></i><b>4.2</b> Exercise 1</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="multilevel-modelling-practical-3-week-4.html"><a href="multilevel-modelling-practical-3-week-4.html#preparation-of-the-data-set"><i class="fa fa-check"></i><b>4.2.1</b> Preparation of the data set</a></li>
<li class="chapter" data-level="4.2.2" data-path="multilevel-modelling-practical-3-week-4.html"><a href="multilevel-modelling-practical-3-week-4.html#fitting-the-random-intercept-and-slope-model"><i class="fa fa-check"></i><b>4.2.2</b> Fitting the random intercept and slope model</a></li>
<li class="chapter" data-level="4.2.3" data-path="multilevel-modelling-practical-3-week-4.html"><a href="multilevel-modelling-practical-3-week-4.html#fitted-lines-by-class"><i class="fa fa-check"></i><b>4.2.3</b> Fitted lines by class</a></li>
<li class="chapter" data-level="4.2.4" data-path="multilevel-modelling-practical-3-week-4.html"><a href="multilevel-modelling-practical-3-week-4.html#the-intercept-only-empty-model-and-icc"><i class="fa fa-check"></i><b>4.2.4</b> The intercept-only / empty model and ICC</a></li>
<li class="chapter" data-level="4.2.5" data-path="multilevel-modelling-practical-3-week-4.html"><a href="multilevel-modelling-practical-3-week-4.html#the-random-intercept-model-with-covariate"><i class="fa fa-check"></i><b>4.2.5</b> The random intercept model (with covariate)</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="multilevel-modelling-practical-3-week-4.html"><a href="multilevel-modelling-practical-3-week-4.html#exercise-2-1"><i class="fa fa-check"></i><b>4.3</b> Exercise 2</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="multilevel-modelling-practical-3-week-4.html"><a href="multilevel-modelling-practical-3-week-4.html#preparation"><i class="fa fa-check"></i><b>4.3.1</b> Preparation</a></li>
<li class="chapter" data-level="4.3.2" data-path="multilevel-modelling-practical-3-week-4.html"><a href="multilevel-modelling-practical-3-week-4.html#the-random-intercept-model"><i class="fa fa-check"></i><b>4.3.2</b> The random intercept model</a></li>
<li class="chapter" data-level="4.3.3" data-path="multilevel-modelling-practical-3-week-4.html"><a href="multilevel-modelling-practical-3-week-4.html#diagnostics"><i class="fa fa-check"></i><b>4.3.3</b> Diagnostics</a></li>
<li class="chapter" data-level="4.3.4" data-path="multilevel-modelling-practical-3-week-4.html"><a href="multilevel-modelling-practical-3-week-4.html#include-a-second-fixed-effect-variable-gender"><i class="fa fa-check"></i><b>4.3.4</b> Include a second fixed effect variable: gender</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="multilevel-modelling-practical-4-week-5.html"><a href="multilevel-modelling-practical-4-week-5.html"><i class="fa fa-check"></i><b>5</b> Multilevel Modelling Practical 4 (Week 5)</a>
<ul>
<li class="chapter" data-level="5.1" data-path="multilevel-modelling-practical-4-week-5.html"><a href="multilevel-modelling-practical-4-week-5.html#instructions-start-here-3"><i class="fa fa-check"></i><b>5.1</b> Instructions – start here!</a></li>
<li class="chapter" data-level="5.2" data-path="multilevel-modelling-practical-4-week-5.html"><a href="multilevel-modelling-practical-4-week-5.html#exercise-1-analysis-of-the-active-time-study-data-lecture-5"><i class="fa fa-check"></i><b>5.2</b> Exercise 1: Analysis of the Active Time study data (lecture 5)</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="multilevel-modelling-practical-4-week-5.html"><a href="multilevel-modelling-practical-4-week-5.html#how-important-is-group-structure-vpcs-and-iccs"><i class="fa fa-check"></i><b>5.2.1</b> How important is group structure? (VPCs and ICCs)</a></li>
<li class="chapter" data-level="5.2.2" data-path="multilevel-modelling-practical-4-week-5.html"><a href="multilevel-modelling-practical-4-week-5.html#three-level-model-with-explanatory-variables"><i class="fa fa-check"></i><b>5.2.2</b> Three level Model with explanatory variables</a></li>
<li class="chapter" data-level="5.2.3" data-path="multilevel-modelling-practical-4-week-5.html"><a href="multilevel-modelling-practical-4-week-5.html#comparison-of-empty-model-with-model-with-explanatory-variables"><i class="fa fa-check"></i><b>5.2.3</b> Comparison of empty model with model with explanatory variables</a></li>
<li class="chapter" data-level="5.2.4" data-path="multilevel-modelling-practical-4-week-5.html"><a href="multilevel-modelling-practical-4-week-5.html#further-analysis-bottom-up-approach"><i class="fa fa-check"></i><b>5.2.4</b> Further analysis (bottom up approach)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="multilevel-modelling-practical-5-week-6.html"><a href="multilevel-modelling-practical-5-week-6.html"><i class="fa fa-check"></i><b>6</b> Multilevel Modelling Practical 5 (Week 6)</a>
<ul>
<li class="chapter" data-level="6.1" data-path="multilevel-modelling-practical-5-week-6.html"><a href="multilevel-modelling-practical-5-week-6.html#instructions---start-here"><i class="fa fa-check"></i><b>6.1</b> Instructions - start here!</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="multilevel-modelling-practical-5-week-6.html"><a href="multilevel-modelling-practical-5-week-6.html#overview"><i class="fa fa-check"></i><b>6.1.1</b> Overview</a></li>
<li class="chapter" data-level="6.1.2" data-path="multilevel-modelling-practical-5-week-6.html"><a href="multilevel-modelling-practical-5-week-6.html#multilevel-modelling-with-longitudinal-data"><i class="fa fa-check"></i><b>6.1.2</b> Multilevel modelling with longitudinal data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="multilevel-modelling-practical-6-week-7.html"><a href="multilevel-modelling-practical-6-week-7.html"><i class="fa fa-check"></i><b>7</b> Multilevel Modelling Practical 6 (Week 7)</a>
<ul>
<li class="chapter" data-level="7.1" data-path="multilevel-modelling-practical-6-week-7.html"><a href="multilevel-modelling-practical-6-week-7.html#instructions---start-here-1"><i class="fa fa-check"></i><b>7.1</b> Instructions - start here!</a></li>
<li class="chapter" data-level="7.2" data-path="multilevel-modelling-practical-6-week-7.html"><a href="multilevel-modelling-practical-6-week-7.html#exercise-1-long-and-wide-data-shape"><i class="fa fa-check"></i><b>7.2</b> Exercise 1 (Long and wide data shape)</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="multilevel-modelling-practical-6-week-7.html"><a href="multilevel-modelling-practical-6-week-7.html#regression-vs-multilevel-analysis"><i class="fa fa-check"></i><b>7.2.1</b> Regression vs multilevel analysis</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="multilevel-modelling-practical-6-week-7.html"><a href="multilevel-modelling-practical-6-week-7.html#exercise-2-simulation-from-the-two-level-longitudinal-model"><i class="fa fa-check"></i><b>7.3</b> Exercise 2 (simulation from the two-level longitudinal model)</a></li>
<li class="chapter" data-level="7.4" data-path="multilevel-modelling-practical-6-week-7.html"><a href="multilevel-modelling-practical-6-week-7.html#end-of-lab"><i class="fa fa-check"></i><b>7.4</b> End of lab!</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="multilevel-modelling-practical-7-week-8.html"><a href="multilevel-modelling-practical-7-week-8.html"><i class="fa fa-check"></i><b>8</b> Multilevel Modelling Practical 7 (Week 8)</a>
<ul>
<li class="chapter" data-level="8.1" data-path="multilevel-modelling-practical-7-week-8.html"><a href="multilevel-modelling-practical-7-week-8.html#instructions---start-here-2"><i class="fa fa-check"></i><b>8.1</b> Instructions - start here!</a></li>
<li class="chapter" data-level="8.2" data-path="multilevel-modelling-practical-7-week-8.html"><a href="multilevel-modelling-practical-7-week-8.html#exercise-1-aids-data-example-2-from-lecture-7"><i class="fa fa-check"></i><b>8.2</b> Exercise 1 (Aids data: Example 2 from lecture 7)</a></li>
<li class="chapter" data-level="8.3" data-path="multilevel-modelling-practical-7-week-8.html"><a href="multilevel-modelling-practical-7-week-8.html#exercise-2-leukaemia-data-example-3-from-lecture-7"><i class="fa fa-check"></i><b>8.3</b> Exercise 2 (Leukaemia data: Example 3 from lecture 7)</a></li>
<li class="chapter" data-level="8.4" data-path="multilevel-modelling-practical-7-week-8.html"><a href="multilevel-modelling-practical-7-week-8.html#exercise-3-toxoplasmosis-data-binomial-logistic-regression"><i class="fa fa-check"></i><b>8.4</b> Exercise 3: Toxoplasmosis data (Binomial logistic regression)</a></li>
<li class="chapter" data-level="8.5" data-path="multilevel-modelling-practical-7-week-8.html"><a href="multilevel-modelling-practical-7-week-8.html#end-of-lab-1"><i class="fa fa-check"></i><b>8.5</b> ## End of lab!</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="multilevel-modelling-practical-8-week-9.html"><a href="multilevel-modelling-practical-8-week-9.html"><i class="fa fa-check"></i><b>9</b> Multilevel Modelling Practical 8 (Week 9)</a>
<ul>
<li class="chapter" data-level="9.1" data-path="multilevel-modelling-practical-8-week-9.html"><a href="multilevel-modelling-practical-8-week-9.html#instructions---start-here-3"><i class="fa fa-check"></i><b>9.1</b> Instructions - start here!</a></li>
<li class="chapter" data-level="9.2" data-path="multilevel-modelling-practical-8-week-9.html"><a href="multilevel-modelling-practical-8-week-9.html#preliminaries"><i class="fa fa-check"></i><b>9.2</b> Preliminaries</a></li>
<li class="chapter" data-level="9.3" data-path="multilevel-modelling-practical-8-week-9.html"><a href="multilevel-modelling-practical-8-week-9.html#exercise-1-betablocker-data"><i class="fa fa-check"></i><b>9.3</b> Exercise 1: Betablocker data</a></li>
<li class="chapter" data-level="9.4" data-path="multilevel-modelling-practical-8-week-9.html"><a href="multilevel-modelling-practical-8-week-9.html#exercise-2-digging-deeper"><i class="fa fa-check"></i><b>9.4</b> Exercise 2 (digging deeper)</a></li>
<li class="chapter" data-level="9.5" data-path="multilevel-modelling-practical-8-week-9.html"><a href="multilevel-modelling-practical-8-week-9.html#exercise-3-optional-toxoplasmosis-data-revisited"><i class="fa fa-check"></i><b>9.5</b> Exercise 3 (optional): Toxoplasmosis data revisited</a></li>
<li class="chapter" data-level="9.6" data-path="multilevel-modelling-practical-8-week-9.html"><a href="multilevel-modelling-practical-8-week-9.html#summative-assessment"><i class="fa fa-check"></i><b>9.6</b> Summative assessment</a></li>
<li class="chapter" data-level="9.7" data-path="multilevel-modelling-practical-8-week-9.html"><a href="multilevel-modelling-practical-8-week-9.html#end-of-lab-2"><i class="fa fa-check"></i><b>9.7</b> ## End of lab!</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="multilevel-modelling-practical-9-week-10.html"><a href="multilevel-modelling-practical-9-week-10.html"><i class="fa fa-check"></i><b>10</b> Multilevel Modelling Practical 9 (Week 10)</a>
<ul>
<li class="chapter" data-level="10.1" data-path="multilevel-modelling-practical-9-week-10.html"><a href="multilevel-modelling-practical-9-week-10.html#dealing-with-missing-values"><i class="fa fa-check"></i><b>10.1</b> Dealing with missing values</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="multilevel-modelling-practical-9-week-10" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number">10</span> Multilevel Modelling Practical 9 (Week 10)<a href="multilevel-modelling-practical-9-week-10.html#multilevel-modelling-practical-9-week-10" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="dealing-with-missing-values" class="section level2 hasAnchor" number="10.1">
<h2><span class="header-section-number">10.1</span> Dealing with missing values<a href="multilevel-modelling-practical-9-week-10.html#dealing-with-missing-values" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Missing values in data are a common phenomenon in real world problems. Knowing how to handle missing values effectively is a required step to reduce bias and to produce powerful models. In this final workshop, we will explore different methods of handling missing data.</p>
<p><span class="math inline">\(~\)</span></p>
<div id="data-preparation-and-pattern" class="section level4 hasAnchor" number="10.1.0.1">
<h4><span class="header-section-number">10.1.0.1</span> Data preparation and pattern<a href="multilevel-modelling-practical-9-week-10.html#data-preparation-and-pattern" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We will use the Boston Housing dataset in the <code>mlbench</code> package to discuss the various approaches to treating missing values. Though the original Boston Housing data doesn’t have missing values, we will randomly introduce missing values. This way, we can validate the imputed missing values against the actual observations, so that we know how effective are the approaches in reproducing the actual data. Lets begin by importing the data from the <code>mlbench</code> package and randomly insert missing values (NA).</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="multilevel-modelling-practical-9-week-10.html#cb297-1" tabindex="-1"></a><span class="fu">require</span>(mlbench)</span>
<span id="cb297-2"><a href="multilevel-modelling-practical-9-week-10.html#cb297-2" tabindex="-1"></a><span class="fu">data</span> (<span class="st">&quot;BostonHousing&quot;</span>, <span class="at">package=</span><span class="st">&quot;mlbench&quot;</span>)  </span>
<span id="cb297-3"><a href="multilevel-modelling-practical-9-week-10.html#cb297-3" tabindex="-1"></a><span class="co"># initialize the data  # load the data</span></span>
<span id="cb297-4"><a href="multilevel-modelling-practical-9-week-10.html#cb297-4" tabindex="-1"></a>original <span class="ot">&lt;-</span> BostonHousing  </span>
<span id="cb297-5"><a href="multilevel-modelling-practical-9-week-10.html#cb297-5" tabindex="-1"></a><span class="co"># backup original data</span></span>
<span id="cb297-6"><a href="multilevel-modelling-practical-9-week-10.html#cb297-6" tabindex="-1"></a><span class="co"># Introduce missing values</span></span>
<span id="cb297-7"><a href="multilevel-modelling-practical-9-week-10.html#cb297-7" tabindex="-1"></a></span>
<span id="cb297-8"><a href="multilevel-modelling-practical-9-week-10.html#cb297-8" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb297-9"><a href="multilevel-modelling-practical-9-week-10.html#cb297-9" tabindex="-1"></a>BostonHousing[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(BostonHousing), <span class="dv">40</span>), <span class="st">&quot;rad&quot;</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb297-10"><a href="multilevel-modelling-practical-9-week-10.html#cb297-10" tabindex="-1"></a>BostonHousing[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(BostonHousing), <span class="dv">40</span>), <span class="st">&quot;ptratio&quot;</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb297-11"><a href="multilevel-modelling-practical-9-week-10.html#cb297-11" tabindex="-1"></a><span class="fu">head</span>(BostonHousing)</span></code></pre></div>
<pre><code>##      crim zn indus chas   nox    rm  age    dis rad tax ptratio      b lstat medv
## 1 0.00632 18  2.31    0 0.538 6.575 65.2 4.0900   1 296    15.3 396.90  4.98 24.0
## 2 0.02731  0  7.07    0 0.469 6.421 78.9 4.9671   2 242    17.8 396.90  9.14 21.6
## 3 0.02729  0  7.07    0 0.469 7.185 61.1 4.9671   2 242    17.8 392.83  4.03 34.7
## 4 0.03237  0  2.18    0 0.458 6.998 45.8 6.0622  NA 222    18.7 394.63  2.94 33.4
## 5 0.06905  0  2.18    0 0.458 7.147 54.2 6.0622   3 222    18.7 396.90  5.33 36.2
## 6 0.02985  0  2.18    0 0.458 6.430 58.7 6.0622   3 222    18.7 394.12  5.21 28.7</code></pre>
<p>The missing values have been inserted in the <code>rad</code> (index of accessibility to radial highways) and <code>ptratio</code> (pupil-teacher ratio by town). Though we know where the missing values are, let’s quickly check the ‘missings’ pattern using <code>md.pattern</code> (a function in <code>mice</code> package).</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="multilevel-modelling-practical-9-week-10.html#cb299-1" tabindex="-1"></a><span class="fu">require</span>(mice)</span>
<span id="cb299-2"><a href="multilevel-modelling-practical-9-week-10.html#cb299-2" tabindex="-1"></a><span class="fu">md.pattern</span>(BostonHousing)  </span></code></pre></div>
<p><img src="MLM_worksheets_files/figure-html/unnamed-chunk-190-1.png" width="672" /></p>
<pre><code>##     crim zn indus chas nox rm age dis tax b lstat medv rad ptratio   
## 430    1  1     1    1   1  1   1   1   1 1     1    1   1       1  0
## 36     1  1     1    1   1  1   1   1   1 1     1    1   1       0  1
## 36     1  1     1    1   1  1   1   1   1 1     1    1   0       1  1
## 4      1  1     1    1   1  1   1   1   1 1     1    1   0       0  2
##        0  0     0    0   0  0   0   0   0 0     0    0  40      40 80</code></pre>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="multilevel-modelling-practical-9-week-10.html#cb301-1" tabindex="-1"></a><span class="co"># pattern or missing values in data.</span></span></code></pre></div>
<p>We see that 36 rows in the data set have a missing value on just <code>ptratio</code>, 36 have a missing value on just <code>rad</code> and 4 rows have both <code>rad</code> and <code>ptratio</code> as missing.</p>
<p><span class="math inline">\(~\)</span></p>
</div>
<div id="method-1.-deleting-the-observations" class="section level4 hasAnchor" number="10.1.0.2">
<h4><span class="header-section-number">10.1.0.2</span> Method 1. Deleting the observations<a href="multilevel-modelling-practical-9-week-10.html#method-1.-deleting-the-observations" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If you have large number of observations in your data set, where all the cases to be predicted are sufficiently well represented in the data, then try deleting (or not to include missing values while model building, for example by setting <code>na.action=na.omit</code>) those observations (rows) that contain missing values. Let’s regress <code>medv</code> on <code>ptratio</code> and <code>rad</code> after deleting the missingness (that is, deleting the rows for which there is at least one missing value), and compare against a model fit that uses the original data set:</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="multilevel-modelling-practical-9-week-10.html#cb302-1" tabindex="-1"></a><span class="co"># Example - regress medv (value of homes) on ptratio and rad</span></span>
<span id="cb302-2"><a href="multilevel-modelling-practical-9-week-10.html#cb302-2" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(medv <span class="sc">~</span> ptratio <span class="sc">+</span> rad, <span class="at">data=</span>BostonHousing, <span class="at">na.action=</span>na.omit) <span class="co">#though na.omit is the default in lm()</span></span>
<span id="cb302-3"><a href="multilevel-modelling-practical-9-week-10.html#cb302-3" tabindex="-1"></a><span class="fu">summary</span>(model1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = medv ~ ptratio + rad, data = BostonHousing, na.action = na.omit)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -18.225  -4.355  -0.964   2.967  33.566 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 57.04649    3.31434  17.212  &lt; 2e-16 ***
## ptratio     -1.76906    0.18788  -9.416  &lt; 2e-16 ***
## rad         -0.20322    0.04862  -4.180 3.54e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 7.659 on 427 degrees of freedom
##   (76 observations deleted due to missingness)
## Multiple R-squared:  0.2894, Adjusted R-squared:  0.2861 
## F-statistic: 86.94 on 2 and 427 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="multilevel-modelling-practical-9-week-10.html#cb304-1" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(medv <span class="sc">~</span> ptratio <span class="sc">+</span> rad, <span class="at">data=</span>original)</span>
<span id="cb304-2"><a href="multilevel-modelling-practical-9-week-10.html#cb304-2" tabindex="-1"></a><span class="fu">summary</span>(model2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = medv ~ ptratio + rad, data = original)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -18.349  -4.567  -1.177   3.001  33.426 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 57.44986    3.18089  18.061  &lt; 2e-16 ***
## ptratio     -1.79043    0.18090  -9.897  &lt; 2e-16 ***
## rad         -0.19621    0.04498  -4.362 1.56e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 7.793 on 503 degrees of freedom
## Multiple R-squared:  0.2849, Adjusted R-squared:  0.2821 
## F-statistic: 100.2 on 2 and 503 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Compare summaries - we see relatively little difference in output.</p>
<p><span class="math inline">\(~\)</span></p>
<p>Let’s dig a little deeper with a synthetic data experiment. We will simulate data from a simple linear regression model, then repeatedly delete a proportion specified by the user, and compare fitted lines.</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="multilevel-modelling-practical-9-week-10.html#cb306-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">43515</span>)</span>
<span id="cb306-2"><a href="multilevel-modelling-practical-9-week-10.html#cb306-2" tabindex="-1"></a>sim <span class="ot">&lt;-</span><span class="cf">function</span>(<span class="at">prop=</span><span class="fl">0.1</span>,<span class="at">N=</span><span class="dv">50</span>)</span>
<span id="cb306-3"><a href="multilevel-modelling-practical-9-week-10.html#cb306-3" tabindex="-1"></a>{</span>
<span id="cb306-4"><a href="multilevel-modelling-practical-9-week-10.html#cb306-4" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">100</span>,<span class="sc">-</span><span class="dv">10</span>,<span class="dv">10</span>)</span>
<span id="cb306-5"><a href="multilevel-modelling-practical-9-week-10.html#cb306-5" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>,<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>x,<span class="dv">5</span>)</span>
<span id="cb306-6"><a href="multilevel-modelling-practical-9-week-10.html#cb306-6" tabindex="-1"></a>  <span class="fu">plot</span>(x,y)</span>
<span id="cb306-7"><a href="multilevel-modelling-practical-9-week-10.html#cb306-7" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="fu">lm</span>(y<span class="sc">~</span>x))</span>
<span id="cb306-8"><a href="multilevel-modelling-practical-9-week-10.html#cb306-8" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N)</span>
<span id="cb306-9"><a href="multilevel-modelling-practical-9-week-10.html#cb306-9" tabindex="-1"></a>  {</span>
<span id="cb306-10"><a href="multilevel-modelling-practical-9-week-10.html#cb306-10" tabindex="-1"></a>    indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,<span class="fu">round</span>(<span class="dv">100</span><span class="sc">*</span>prop))</span>
<span id="cb306-11"><a href="multilevel-modelling-practical-9-week-10.html#cb306-11" tabindex="-1"></a>    ymis <span class="ot">&lt;-</span> y[<span class="sc">-</span>indices]</span>
<span id="cb306-12"><a href="multilevel-modelling-practical-9-week-10.html#cb306-12" tabindex="-1"></a>    xmis <span class="ot">&lt;-</span> x[<span class="sc">-</span>indices]</span>
<span id="cb306-13"><a href="multilevel-modelling-practical-9-week-10.html#cb306-13" tabindex="-1"></a>    <span class="fu">lines</span>(<span class="fu">abline</span>(<span class="fu">lm</span>(ymis<span class="sc">~</span>xmis),<span class="at">col=</span>i))</span>
<span id="cb306-14"><a href="multilevel-modelling-practical-9-week-10.html#cb306-14" tabindex="-1"></a>  }</span>
<span id="cb306-15"><a href="multilevel-modelling-practical-9-week-10.html#cb306-15" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>TASK:</strong> Make sure you understand what the above function is doing. Execute the function for different values of <code>prop</code> e.g. 0.1, 0.5, 0.9. Is the behaviour as expected?</p>
<details>
<summary>
Click for solution
</summary>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="multilevel-modelling-practical-9-week-10.html#cb307-1" tabindex="-1"></a><span class="co">#prop=0.1</span></span>
<span id="cb307-2"><a href="multilevel-modelling-practical-9-week-10.html#cb307-2" tabindex="-1"></a><span class="fu">sim</span>()</span></code></pre></div>
<p><img src="MLM_worksheets_files/figure-html/unnamed-chunk-193-1.png" width="672" /></p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="multilevel-modelling-practical-9-week-10.html#cb308-1" tabindex="-1"></a><span class="co">#prop=0.5</span></span>
<span id="cb308-2"><a href="multilevel-modelling-practical-9-week-10.html#cb308-2" tabindex="-1"></a><span class="fu">sim</span>(<span class="at">prop=</span><span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="MLM_worksheets_files/figure-html/unnamed-chunk-193-2.png" width="672" /></p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="multilevel-modelling-practical-9-week-10.html#cb309-1" tabindex="-1"></a><span class="co">#prop=0.8</span></span>
<span id="cb309-2"><a href="multilevel-modelling-practical-9-week-10.html#cb309-2" tabindex="-1"></a><span class="fu">sim</span>(<span class="at">prop=</span><span class="fl">0.9</span>)</span></code></pre></div>
<p><img src="MLM_worksheets_files/figure-html/unnamed-chunk-193-3.png" width="672" /></p>
Unsurprisingly, the lines become more variable as the proportion of missingness increases. Nevertheless, if we were to look at the average intercept and slope values, we’d find that these would be close to the ground truth values. The missingness mechanism is MCAR so we expect increased variance in the parameter estimates but no increase in bias.
</details>
<p><span class="math inline">\(~\)</span></p>
</div>
<div id="imputation-with-mean-median-mode" class="section level4 hasAnchor" number="10.1.0.3">
<h4><span class="header-section-number">10.1.0.3</span> 2. Imputation with mean / median / mode<a href="multilevel-modelling-practical-9-week-10.html#imputation-with-mean-median-mode" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Replacing the missing values with the mean / median / mode is a crude way of treating missing values. Depending on the context, e.g. if the variation is low or if the variable has low leverage over the response, such a rough approximation is acceptable and could possibly give satisfactory results.</p>
<p>Let’s impute using the mean for the Boston Housing data <code>ptratio</code> variable. The following code chunk demonstrates how this can be done without overwriting the <code>BostonHousing</code> data.</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="multilevel-modelling-practical-9-week-10.html#cb310-1" tabindex="-1"></a>BostonHousing2 <span class="ot">&lt;-</span> BostonHousing <span class="co">#Copy the data to avoid an overwrite</span></span>
<span id="cb310-2"><a href="multilevel-modelling-practical-9-week-10.html#cb310-2" tabindex="-1"></a>BostonHousing2<span class="sc">$</span>ptratio[<span class="fu">is.na</span>(BostonHousing2<span class="sc">$</span>ptratio)] <span class="ot">&lt;-</span> <span class="fu">mean</span>(BostonHousing2<span class="sc">$</span>ptratio, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) </span>
<span id="cb310-3"><a href="multilevel-modelling-practical-9-week-10.html#cb310-3" tabindex="-1"></a><span class="fu">md.pattern</span>(BostonHousing2)  </span></code></pre></div>
<p><img src="MLM_worksheets_files/figure-html/unnamed-chunk-194-1.png" width="672" /></p>
<pre><code>##     crim zn indus chas nox rm age dis tax ptratio b lstat medv rad   
## 466    1  1     1    1   1  1   1   1   1       1 1     1    1   1  0
## 40     1  1     1    1   1  1   1   1   1       1 1     1    1   0  1
##        0  0     0    0   0  0   0   0   0       0 0     0    0  40 40</code></pre>
<p>Compute the accuracy:</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="multilevel-modelling-practical-9-week-10.html#cb312-1" tabindex="-1"></a>actuals <span class="ot">&lt;-</span> original<span class="sc">$</span>ptratio[<span class="fu">is.na</span>(BostonHousing<span class="sc">$</span>ptratio)]</span>
<span id="cb312-2"><a href="multilevel-modelling-practical-9-week-10.html#cb312-2" tabindex="-1"></a>predicteds <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">mean</span>(BostonHousing<span class="sc">$</span>ptratio, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="fu">length</span>(actuals))</span>
<span id="cb312-3"><a href="multilevel-modelling-practical-9-week-10.html#cb312-3" tabindex="-1"></a>mae <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(actuals <span class="sc">-</span> predicteds))</span>
<span id="cb312-4"><a href="multilevel-modelling-practical-9-week-10.html#cb312-4" tabindex="-1"></a>mse <span class="ot">&lt;-</span> <span class="fu">mean</span>((actuals <span class="sc">-</span> predicteds)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb312-5"><a href="multilevel-modelling-practical-9-week-10.html#cb312-5" tabindex="-1"></a>rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(mse)</span>
<span id="cb312-6"><a href="multilevel-modelling-practical-9-week-10.html#cb312-6" tabindex="-1"></a>smape <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="dv">2</span> <span class="sc">*</span> <span class="fu">abs</span>(actuals <span class="sc">-</span> predicteds) <span class="sc">/</span> (<span class="fu">abs</span>(actuals) <span class="sc">+</span> <span class="fu">abs</span>(predicteds)) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb312-7"><a href="multilevel-modelling-practical-9-week-10.html#cb312-7" tabindex="-1"></a><span class="fu">list</span>(<span class="at">MAE =</span> mae, <span class="at">MSE =</span> mse, <span class="at">RMSE =</span> rmse, <span class="at">sMAPE =</span> smape)</span></code></pre></div>
<pre><code>## $MAE
## [1] 1.70029
## 
## $MSE
## [1] 3.908088
## 
## $RMSE
## [1] 1.976888
## 
## $sMAPE
## [1] 9.348085</code></pre>
<p>Note the RMSE value. We will use benchmark further methods against this.</p>
<p><span class="math inline">\(~\)</span></p>
</div>
<div id="prediction" class="section level4 hasAnchor" number="10.1.0.4">
<h4><span class="header-section-number">10.1.0.4</span> 3. Prediction<a href="multilevel-modelling-practical-9-week-10.html#prediction" class="anchor-section" aria-label="Anchor link to header"></a></h4>
</div>
<div id="knn-imputation" class="section level4 hasAnchor" number="10.1.0.5">
<h4><span class="header-section-number">10.1.0.5</span> 3.1. kNN Imputation<a href="multilevel-modelling-practical-9-week-10.html#knn-imputation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>DMwR::knnImputation</code> uses a k-Nearest neighbours approach to impute missing values. kNN imputation in simpler terms is as follows: for every observation to be imputed, it identifies the ‘k’ closest observations based on euclidean distance and computes the weighted average (weighted based on inverse distance) of these ‘k’ observations.</p>
<p>The advantage is that you can impute all the missing values in all variables with one call to the function. It takes the whole data frame as the argument and you don’t even have to specify which variable you want to impute.</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="multilevel-modelling-practical-9-week-10.html#cb314-1" tabindex="-1"></a><span class="fu">library</span>(DMwR2)</span>
<span id="cb314-2"><a href="multilevel-modelling-practical-9-week-10.html#cb314-2" tabindex="-1"></a>knnOutput <span class="ot">&lt;-</span> <span class="fu">knnImputation</span>(BostonHousing)  <span class="co">#Don&#39;t include the response.</span></span>
<span id="cb314-3"><a href="multilevel-modelling-practical-9-week-10.html#cb314-3" tabindex="-1"></a><span class="fu">anyNA</span>(knnOutput)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>Compute the accuracy using just the <code>ptratio</code> variable (to allow comparison with that obtained when using mean imputation).</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="multilevel-modelling-practical-9-week-10.html#cb316-1" tabindex="-1"></a>actuals <span class="ot">&lt;-</span> original<span class="sc">$</span>ptratio[<span class="fu">is.na</span>(BostonHousing<span class="sc">$</span>ptratio)]</span>
<span id="cb316-2"><a href="multilevel-modelling-practical-9-week-10.html#cb316-2" tabindex="-1"></a>predicteds <span class="ot">&lt;-</span> knnOutput[<span class="fu">is.na</span>(BostonHousing<span class="sc">$</span>ptratio), <span class="st">&quot;ptratio&quot;</span>]</span>
<span id="cb316-3"><a href="multilevel-modelling-practical-9-week-10.html#cb316-3" tabindex="-1"></a>mse <span class="ot">&lt;-</span> <span class="fu">mean</span>((actuals <span class="sc">-</span> predicteds)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb316-4"><a href="multilevel-modelling-practical-9-week-10.html#cb316-4" tabindex="-1"></a>rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(mse)</span>
<span id="cb316-5"><a href="multilevel-modelling-practical-9-week-10.html#cb316-5" tabindex="-1"></a>rmse</span></code></pre></div>
<pre><code>## [1] 0.9329963</code></pre>
<p>How much has root mean square error (RMSE) improved by?</p>
<p><span class="math inline">\(~\)</span></p>
</div>
<div id="mice" class="section level4 hasAnchor" number="10.1.0.6">
<h4><span class="header-section-number">10.1.0.6</span> 3.2 mice<a href="multilevel-modelling-practical-9-week-10.html#mice" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>“mice” is short for “Multivariate Imputation by Chained Equations” and is an R package that provides advanced features for missing value treatment. It uses a slightly uncommon way of implementing the imputation in 2-steps, using <code>mice()</code> to build the model and <code>complete()</code> to generate the completed data. The <code>mice(df)</code> function produces multiple complete copies of the data frame <code>df</code>, each with different imputations of the missing data. The <code>complete()</code> function returns one or several of these data sets, with the default being the first.</p>
<p>Let’s see how to impute <code>ptratio</code>.</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="multilevel-modelling-practical-9-week-10.html#cb318-1" tabindex="-1"></a>miceMod <span class="ot">&lt;-</span> <span class="fu">mice</span>(BostonHousing, <span class="at">method=</span><span class="st">&quot;norm.predict&quot;</span>)  <span class="co"># perform mice imputation, based on linear regression.</span></span></code></pre></div>
<pre><code>## 
##  iter imp variable
##   1   1  rad  ptratio
##   1   2  rad  ptratio
##   1   3  rad  ptratio
##   1   4  rad  ptratio
##   1   5  rad  ptratio
##   2   1  rad  ptratio
##   2   2  rad  ptratio
##   2   3  rad  ptratio
##   2   4  rad  ptratio
##   2   5  rad  ptratio
##   3   1  rad  ptratio
##   3   2  rad  ptratio
##   3   3  rad  ptratio
##   3   4  rad  ptratio
##   3   5  rad  ptratio
##   4   1  rad  ptratio
##   4   2  rad  ptratio
##   4   3  rad  ptratio
##   4   4  rad  ptratio
##   4   5  rad  ptratio
##   5   1  rad  ptratio
##   5   2  rad  ptratio
##   5   3  rad  ptratio
##   5   4  rad  ptratio
##   5   5  rad  ptratio</code></pre>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="multilevel-modelling-practical-9-week-10.html#cb320-1" tabindex="-1"></a>miceOutput <span class="ot">&lt;-</span> <span class="fu">complete</span>(miceMod)  <span class="co"># generate the completed data.</span></span>
<span id="cb320-2"><a href="multilevel-modelling-practical-9-week-10.html#cb320-2" tabindex="-1"></a><span class="fu">anyNA</span>(miceOutput)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>The <code>norm.predict</code> argument uses predicted values from linear regression to impute the missingness. Have a look at the help file for <code>mice</code> to see what other methods are possible. For those that did the Machine Learning module, several will be familiar!</p>
<p>Compute the accuracy of <code>ptratio</code>:</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="multilevel-modelling-practical-9-week-10.html#cb322-1" tabindex="-1"></a>actuals <span class="ot">&lt;-</span> original<span class="sc">$</span>ptratio[<span class="fu">is.na</span>(BostonHousing<span class="sc">$</span>ptratio)]</span>
<span id="cb322-2"><a href="multilevel-modelling-practical-9-week-10.html#cb322-2" tabindex="-1"></a>predicteds <span class="ot">&lt;-</span> miceOutput[<span class="fu">is.na</span>(BostonHousing<span class="sc">$</span>ptratio), <span class="st">&quot;ptratio&quot;</span>]</span>
<span id="cb322-3"><a href="multilevel-modelling-practical-9-week-10.html#cb322-3" tabindex="-1"></a>mse <span class="ot">&lt;-</span> <span class="fu">mean</span>((actuals <span class="sc">-</span> predicteds)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb322-4"><a href="multilevel-modelling-practical-9-week-10.html#cb322-4" tabindex="-1"></a>rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(mse)</span>
<span id="cb322-5"><a href="multilevel-modelling-practical-9-week-10.html#cb322-5" tabindex="-1"></a>rmse</span></code></pre></div>
<pre><code>## [1] 1.488587</code></pre>
<p>We seem to be doing worse (or at least no better?) than the knn approach (but we’re not really harnessing the full power of the <code>mice</code> package).</p>
<p>An additional benefit of <code>mice</code> is that it can also handle factors.</p>
<p>The <code>rad</code> variable takes values from <span class="math inline">\(\{1,2,\ldots,24\}\)</span>. There may be good reasons for treating it as continuous, but for the purposes of demonstration, let’s treat it as discrete.</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="multilevel-modelling-practical-9-week-10.html#cb324-1" tabindex="-1"></a>miceMod <span class="ot">&lt;-</span> <span class="fu">mice</span>(BostonHousing, <span class="at">method=</span><span class="st">&quot;cart&quot;</span>) <span class="co">#perform mice imputation, based on classification and regression trees (CART).</span></span></code></pre></div>
<pre><code>## 
##  iter imp variable
##   1   1  rad  ptratio
##   1   2  rad  ptratio
##   1   3  rad  ptratio
##   1   4  rad  ptratio
##   1   5  rad  ptratio
##   2   1  rad  ptratio
##   2   2  rad  ptratio
##   2   3  rad  ptratio
##   2   4  rad  ptratio
##   2   5  rad  ptratio
##   3   1  rad  ptratio
##   3   2  rad  ptratio
##   3   3  rad  ptratio
##   3   4  rad  ptratio
##   3   5  rad  ptratio
##   4   1  rad  ptratio
##   4   2  rad  ptratio
##   4   3  rad  ptratio
##   4   4  rad  ptratio
##   4   5  rad  ptratio
##   5   1  rad  ptratio
##   5   2  rad  ptratio
##   5   3  rad  ptratio
##   5   4  rad  ptratio
##   5   5  rad  ptratio</code></pre>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="multilevel-modelling-practical-9-week-10.html#cb326-1" tabindex="-1"></a>miceOutput <span class="ot">&lt;-</span> <span class="fu">complete</span>(miceMod)  <span class="co">#generate the completed data.</span></span>
<span id="cb326-2"><a href="multilevel-modelling-practical-9-week-10.html#cb326-2" tabindex="-1"></a><span class="fu">anyNA</span>(miceOutput)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>Now compute the accuracy of rad:</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="multilevel-modelling-practical-9-week-10.html#cb328-1" tabindex="-1"></a>actuals <span class="ot">&lt;-</span> original<span class="sc">$</span>rad[<span class="fu">is.na</span>(BostonHousing<span class="sc">$</span>rad)]</span>
<span id="cb328-2"><a href="multilevel-modelling-practical-9-week-10.html#cb328-2" tabindex="-1"></a>predicteds <span class="ot">&lt;-</span> miceOutput[<span class="fu">is.na</span>(BostonHousing<span class="sc">$</span>rad), <span class="st">&quot;rad&quot;</span>]</span>
<span id="cb328-3"><a href="multilevel-modelling-practical-9-week-10.html#cb328-3" tabindex="-1"></a><span class="fu">mean</span>(actuals <span class="sc">!=</span> predicteds)  <span class="co"># compute misclass error.</span></span></code></pre></div>
<pre><code>## [1] 0.175</code></pre>
<p>Note that classification and regression trees (the imputation method used above) is beyond the scope of the course (although several of you will know this from the Machine Learning module).</p>
<p>Let’s complete the multiple imputation workflow. We use the <code>with</code> function to fit the regression model to each of the 5 imputed data sets:</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="multilevel-modelling-practical-9-week-10.html#cb330-1" tabindex="-1"></a>model3 <span class="ot">&lt;-</span> <span class="fu">with</span>(miceMod,<span class="fu">lm</span>(medv <span class="sc">~</span> ptratio <span class="sc">+</span> rad))</span>
<span id="cb330-2"><a href="multilevel-modelling-practical-9-week-10.html#cb330-2" tabindex="-1"></a><span class="fu">summary</span>(model3)</span></code></pre></div>
<pre><code>## # A tibble: 15 × 7
##    term        estimate std.error statistic  p.value  nobs df.residual
##    &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;       &lt;dbl&gt;
##  1 (Intercept)   56.6      3.15       18.0  4.78e-56   506         503
##  2 ptratio       -1.74     0.179      -9.71 1.53e-20   506         503
##  3 rad           -0.203    0.0449     -4.52 7.70e- 6   506         503
##  4 (Intercept)   56.9      3.18       17.9  1.04e-55   506         503
##  5 ptratio       -1.75     0.181      -9.72 1.45e-20   506         503
##  6 rad           -0.206    0.0451     -4.57 6.21e- 6   506         503
##  7 (Intercept)   56.7      3.16       17.9  5.46e-56   506         503
##  8 ptratio       -1.74     0.179      -9.72 1.36e-20   506         503
##  9 rad           -0.203    0.0450     -4.51 8.07e- 6   506         503
## 10 (Intercept)   56.6      3.16       17.9  9.37e-56   506         503
## 11 ptratio       -1.74     0.180      -9.68 2.02e-20   506         503
## 12 rad           -0.204    0.0451     -4.52 7.84e- 6   506         503
## 13 (Intercept)   56.5      3.15       17.9  6.15e-56   506         503
## 14 ptratio       -1.73     0.179      -9.68 1.96e-20   506         503
## 15 rad           -0.209    0.0450     -4.63 4.65e- 6   506         503</code></pre>
<p>Finally, use the <code>pool</code> function to pool results:</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="multilevel-modelling-practical-9-week-10.html#cb332-1" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">pool</span>(model3))</span></code></pre></div>
<pre><code>##          term   estimate  std.error statistic       df      p.value
## 1 (Intercept) 56.6434253 3.16571683 17.892764 499.1928 1.103289e-55
## 2     ptratio -1.7415941 0.17975027 -9.688965 499.4531 1.855954e-20
## 3         rad -0.2049607 0.04512901 -4.541661 498.7355 7.006823e-06</code></pre>
<p>If you wish, you can compare the results to those obtained using the orginal data set.</p>
<p><span class="math inline">\(~\)</span></p>
</div>
<div id="references" class="section level4 hasAnchor" number="10.1.0.7">
<h4><span class="header-section-number">10.1.0.7</span> <strong>References</strong><a href="multilevel-modelling-practical-9-week-10.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Rubin, D. B. Multiple imputation for nonresponse in surveys. John Wiley &amp; Sons, 1987.</p>
<p>Schafer, J.L. (1997). Analysis of Incomplete Multivariate Data. London: Chapman &amp; Hall. Table 6.14.</p>
<p>Van Buuren, S. and Groothuis-Oudshoorn, K. (2011). mice: Multivariate Imputation by Chained Equations in R. Journal of Statistical Software, 45(3), 1-67. pdf</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="multilevel-modelling-practical-8-week-9.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
},
"sidebar": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
